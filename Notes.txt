# Notes

## Pseudo Issues

### Bugs / Fixes needed

    - genome fasta is *only* used for gtc2vcf
        --> check if it's needed / what difference it makes
        --> allow it to be optional

### Feature Wishlist (somewhat orderd)

    - More analysis on array & genome
        - (avg) probe density
            -> default density filter?
        - Flag centromers
        - Get q,p arm (sub)cooridinates
            -> some UCSC functions should allow this
        - this should also provide / set chr standard format (see below)

        + Gap detection

        --> either add this to preprocess script
        OR
        --> make a new script that adds annotations/filters/flags to CNV calls

    - Consistent handling of "chr" format
        - Either specify in config, or use format from vcf / fastq / ?
        - then always use this format
        - Current Issues: penncnv gcmodel files need to be done in <1:22, X, Y> format (?)AND need to match pfb file
            -> could be remedied by using USCS downloadable stuff? or by generating this from fasta file (unclear how long that would take)

    - Proper vcf output:
        - Preprocess step / final VCF:
            - one combined vcf file
              - combined calls from tools
              - might want to retain pre-filtered calls (?)
              - might want to add additional filters
              - unclear if all current cols of the tsv can easily be but into vcf
            - could replace current preprocess tsv output, instead of only adding vcf ?! (undecided)

        Optional:
        - per tool vcf output (& getting rid of internal tsv files ?)
            - needs extra rule for PennCNV
                -> maybe mark PennCNV file as intermediate?
            - other tools should be possible directly from R

    - transfer to github
        - general linting
        - cleanup of TODO comments
        - start using CI
        - start writing tests

    - better installation & windows support
        - dockerize
            -> doesn't make a full dockerimage, just one where the rules can be run in
        - switch to conda envs defined in snakemake
        - find / setup a good docker container to replace iaap download?
            -> after that stick to conda (+docker) available stuff

    - Actual checks if ROIs contain CNV evidence
        - test the PennCNV module for that
        - allow global definition of regions (in config?)
        - add reference calls as (secondary) ROIs ?

    - vcf output for variants & filtering change:
        - remove the generation of raw data in tsv format
        - do filtering on the vcf file instead
        - output a filtered vcf file where probes are masked / 'FILTER' is set properly

    - Call merging overhaul:
        - merging by number of probes between them
        - merging by relative value
        - merging by absolute value

    - improved wrapper script
        - auto detection if PennCNV files are missing & prompt to get them


    - Test & add more CNV callers
        - Ascat (tumor/normal)
        - GLAD (germline)
        - VEGA (germline)

    - Additional filter options
        - MAF (need to get from databank?)
            - other databank features
        - any of the vcf exported features maybe?
        - some ideas here (3 select SNP markers): https://currentprotocols.onlinelibrary.wiley.com/doi/full/10.1002/cpz1.621

    - generation of CNV reference set shared between celllines

### Report Wishlist

    - CircO plots / golsing / ...


## Mosaicism

Some papers are in zotero, summary:

- many methods are specifically designed for tumors samples, I Mostly ignored those
  - potentially useful perl scripts here: https://baseplugins.thep.lu.se/wiki/se.lu.onk.BAFsegmentation
  -> relies on BAF transformation (remove 0&1, mirror at 0.5, then segment)

- generally done by some specific model on BAF (the PennCNV model i.e., does not cover this); one paper on CDF but without code
- good models/papers/approaches seem to train/evaluate the model based in experimentally mixed samples.
- GADA might be able to do this? would need to be tested
